# 性能测试

## 思维差异

- 功能测试、自动化测试
  - 输出： 找bug  预期结果与实际结果进行比较
  - 隐藏的前提：模拟都是1个用户的操作

  + 性能测试
    + 不是模拟1个人，**模拟多个人同时**，
    + 关注==>多个人操作时，响应时间，
    + 接口服务器性能测试中，一定是多个人同时操作，才是性能测试

## 性能测试概念

100个人同时登录接口进行登录，性能中的`avgRT(平均响应时间)`应该在多少，是可以被接受的？

- 可接受的范围 1.5s，常规说的2-5-8为域名的响应时间
- 1.5s APDEX 用户满意度指数

事务：一个请求行为，并不一定只有一个接口，所以，一个事务可能是多个接口。

- jmeter：默认情况下，1个接口请求一次，认为一个1个事务`Transation`
  - 也可以是通过事务控制器，挂载多个接口请求，合并成为1个事务
- 是从发起，到网络传输，收到响应

## 什么是性能测试

性能：事务、物品的某些特征的评价值

## 性能测试

- 通过工具，模拟多用户发起请求，获取**性能指标值**
  - 用工具来模拟多个人的方式很多
    - 进程： 资源拥有者，创造进程消耗的是CPU、和内存。资源消耗会比较大。LR
      - 进程+ 线程： ngrinder
      - 协程： python+locust
    - 线程:  使用进程的资源，来干。jmeter、lr

## 性能指标

- `avgRT`	平均响应时间	90%
- `TPS`        服务器每秒处理的事务数
  - **衡量服务器处理能力**的最重要的指标
- 吞吐量：**网络**中每秒传输的事务数
  - **没有网络瓶颈**：tps 数值 = 吞吐量数值
  - **如果网络有瓶颈**: tps 数值 != 吞吐量数值
- 吞吐率  每秒钟能通过多少kb数据
- 服务器资源利用率
  - cpu、内存、io的利用率
- 并发用户数：
  - 同一时间发起请求 用户数
    + 广义并发： 同一时间发起请求(相同、不相同)
    + 狭义并发：同一时间发起相同请求
         + 集合点：集合多个人在同一时间发起相同请求
  - 并发用数100   发起请求，一秒钟会发起多少请求？（请求的频率）不知道，所以1秒钟总请求量，不知道，

## 负载测试

- **逐步增加**并发用户数，测试系统性能变化，找出最大 拐点区间
  -  逐步增加并发用户数，
  -  区间怎么判断
    - 有没有报错
    - tps下降
    - 响应时间变长

50tps： 服务器每秒能处理50个事务

50 t/s  * 60 * 60 = 18w     300tps

假设一天为8h：18w  * 8h  = 144w

耗时：一般测试都是几分钟，十几分钟

### 压力测试

使用一定量的并发用户数，持续运行一个较长时间，看系统服务以及各资源利用情况稳定性，一般以小时为单位7*24小时。

- 一定量：访问 小于最大并发用户数	20% 或者 80%  MaxThreads

## 性能测试

性能测试：通过工具，模拟一定量的并发用户数，向服务器发起请求，获得我们性能指标

- 通过进行负载测试，得到最大并发用户数的拐点，在服务器进行性能测试，得到当前平均响应时间、资源利用率的数据进行性能测试报告

耗时：一般都是几分钟

## 常见性能指标

TPS:  **服务器**每秒处理事务数   服务器的综合处理能力

吞吐量：**网络**每秒能通过的事务

rps： 请求，每秒**用户**请求率     **发起方**，用户每秒能够发起的请求

qps： 每秒查询率， **服务器**的查询

- 在企业中，如果没有严格区分，是把1个事务，当做只查询1次，但，实际请求可能是 1事务: n个查询

hps：hit per seconds  每秒**用户**点击率  页面点击

## 容量测试

在一定的软、硬件条件下，在数据库不同数量级数据量的情况下，对系统中读\写比较多的业务进行测试，从而获得不同数据量级下的性能指标值

在性能测试时，如果数据库的数据量级是不一致的，性能指标值，也可能存在差异。 **在做性能测试时，数据库的数据量级一定要保证一致。**

生成的数据库数据量级  百万级

测试用的环境，独立性能测试环境， 不超过万

性能测试，不能使用功能测试环境、自动化测试环境、验收、生成环境都不能用。需要自己搭建独立环境

自己搭建：

独立环境：真正的性能测试环境，机器资源配置是和生产完全一样（硬件配置一样、数量一样、网络一样、架构参数一样）

网络：网络架构，网络基础，性能测试，不能使用无线网络，也不要去使用vpn等桥连，尽可能使用局域网

- 不使用无线网络，是因为网络不稳定，会导致阻塞
- 不是用VPN是因为不安全

## 性能测试的前提

+ 性能测试并不是想做就做？

  + 核心的业务，用户量最大优先

  可测性：反复沟通确定性能指标

+ 性能测试流程
  +  性能测试准备
     +  需求分析
     +  明确性能测试目标(指标值)
     +  了解软件功能、架构
     +  指定测试计划、做好工作量评估
     +  制定 测试模型(编辑测试用例)
  +  搭建性能测试环境
     +  工具选型与准备
     +  被测系统环境搭建(服务器、服务版本更新、**数据库数据准备**(数据量级))
     +  网络配置
  +  性能测试脚本开发
     +  选取协议
     +  制作脚本
     +  调试脚本
     +  验证脚本
  +  性能测试脚本执行
     +  试运行
     +  场景执行
  +  结果分析与调优
     +  分析数据：结果图表
     +  分析思路：服务器硬件瓶颈>网络瓶颈>服务器os瓶颈(参数配置、数据库、WEB服务器)>应用瓶颈(SQL语句、数据库设计、业务逻辑、算法)
     +  调优
     +  修改脚本或场景
  +  测试报告与结果跟踪
     +  性能测试报告
     +  性能测试问题跟踪

### 必要性研究--关键项评估

- 主管部门、监管部门审查--12306
- 涉及生命财产安全--银行系统
- 大型新系统
- 核心系统
- 架构调整
- 业务剧增
- 重大缺陷修复

### 可测性--可量化为性能指标值

![img](https://img-blog.csdnimg.cn/201c10e205724defbf22f8225343cfe9.png)
